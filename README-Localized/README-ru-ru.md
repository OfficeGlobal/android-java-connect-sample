# Приложение Connect для Android, использующее Microsoft Graph SDK


>**Примечание.** Мы обновили этот пример, чтобы использовать [Библиотеку проверки подлинности Майкрософт (MSAL)](https://github.com/AzureAD/microsoft-authentication-library-for-android) для приложений Android.


> **Создаете приложения для корпоративных клиентов?** Ваше приложение может не работать, если корпоративный клиент включит функции корпоративной безопасности для мобильных устройств, например <a href="https://azure.microsoft.com/en-us/documentation/articles/active-directory-conditional-access-device-policies/" target="_newtab">условный доступ с устройств</a>. В этом случае у пользователей могут возникать ошибки, а вы не будете об этом знать. 

> Для поддержки **всех корпоративных клиентов** в **любых корпоративных сценариях** необходимо использовать конечную точку Azure AD и управлять приложениями с помощью [портала управления Azure](https://aka.ms/aadapplist). Дополнительные сведения см. в разделе [Выбор между конечными точками Azure AD и Azure AD версии 2.0](https://graph.microsoft.io/docs/authorization/auth_overview#deciding-between-azure-ad-and-the-v2-authentication-endpoint).

[![Пример Microsoft Graph Connect.](/readme-images/O365-Android-Connect-video_play_icon.png)![Щелкните, чтобы просмотреть пример в действии](/readme-images/O365-Android-Connect-video_play_icon.png)

Чтобы начать работу со службами и данными Office 365, приложение для Android должно подключиться к Microsoft Graph. В этом примере показано, как подключиться, а затем вызвать один API через пакет SDK Microsoft Graph.

## Требования к устройству

Для запуска приложения для подключения устройство должно соответствовать следующим требованиям:

* размер экрана должен составлять не менее 800 x 480;
* должен использоваться API Android 16 или более высокого уровня.
 
## Необходимые компоненты

Для работы с приложением Connect для Android необходимы следующие компоненты:

* [Android Studio](http://developer.android.com/sdk/index.html) версии 1.0 или более поздней.
* [Java Development Kit (JDK) 7](http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html).

<a name="register"></a>
## Регистрация и настройка приложения

1. Откройте браузер и перейдите к [Центру администрирования Azure Active Directory](https://aad.portal.azure.com). Войдите с помощью **рабочей или учебной учетной записи**.

1. Выберите **Azure Active Directory** на панели навигации слева, затем выберите **Регистрация приложения (предварительный просмотр)** в разделе **Управление**.

    ![Снимок экрана раздела регистрации приложений](./readme-images/aad-portal-app-registrations.png)

1. Выберите **Новая регистрация**. На странице **Регистрация приложения** задайте необходимые значения следующим образом:

    - задайте предпочитаемое **имя**, например `AndroidJavaConnect`
    - в разделе **Поддерживаемые типы учетных записей** установите значение **Учетные записи в любом каталоге организации**.

    ![Снимок экрана страницы регистрации приложения](./readme-images/aad-register-an-app.PNG)

1. Нажмите кнопку **Зарегистрировать**. На странице приложения **AndroidJavaConnect** выберите **Обзор**, скопируйте значение **Идентификатора приложения (клиента)** и сохраните его, оно потребуется на следующем шаге.

    ![Снимок экрана: идентификатор приложения](./readme-images/aad-application-id.PNG)

1. На странице приложения выберите пункт **Проверка подлинности**. Найдите раздел **URI перенаправления**. В разделе _предлагаемых URI перенаправления для общедоступных клиентов (мобильные устройства, настольные компьютеры)_ установите второй флажок, чтобы разрешить работу с используемыми в приложении библиотеками MSAL. (Поле должно содержать параметр _msal<YOUR\_CLIENT\_ID>://auth_). Нажмите кнопку **Сохранить**.

    ![Снимок экрана: предлагаемые URI перенаправления для общедоступного клиента](./readme-images/aad-redirect-uri-public-client.PNG)
  
Информацию о проверке подлинности с помощью MSAL для Android для вызова Microsoft Graph см. в статье [Вызов API Microsoft Graph из приложения Android](https://docs.microsoft.com/en-us/azure/active-directory/develop/guidedsetups/active-directory-android).

  
## Открытие примера с помощью Android Studio

1. Установите [Android Studio](http://developer.android.com/sdk/index.html) и добавьте пакеты SDK для Android в соответствии с [инструкциями](http://developer.android.com/sdk/installing/adding-packages.html) на сайте developer.android.com.
2. Скачайте или клонируйте этот пример.
4. Запустите Android Studio.
	1. Закройте все открытые проекты, а затем выберите команду **Открыть существующий проект Android Studio**.
	2. Откройте локальный репозиторий и выберите проект Android-Connect. Нажмите **ОК**.
	
	> Примечание. Если у вас не установлен пакет **Репозиторий поддержки Android**, Android Studio покажет уведомление **Обнаружены платформы**. Чтобы этого избежать, откройте диспетчер SDK и добавьте пакет "Репозиторий поддержки Android" .
5. Откройте AndroidManifest.xml
	* Вместо фразы *ВВЕДИТЕ\_ИДЕНТИФИКАТОР\_КЛИЕНТА* в обоих местах вставьте код приложения, который вы сохранили в предыдущем разделе.
6. Создайте приложение и установите .APK на устройстве или в эмуляторе.
7. Включите на устройстве или в эмуляторе разрешения для **хранилища** для установленного примера приложения
8. Скачайте изображение test.jpg из `android-java-connect-sample/app/src/main/res/drawable/test.jpg` в корневой каталог внешнего хранилища устройства.



После сборки пример подключения можно запустить в эмуляторе или на устройстве. Выберите устройство с API 16 или более высокого уровня в диалоговом окне **Выбор устройства**.

Дополнительные сведения о примере приложения см. в статье [Вызов Microsoft Graph в приложении для Android](https://developer.microsoft.com/en-us/graph/docs/concepts/android).

<a name="contributing"></a>
## Участие ##

Если вы хотите добавить код в этот пример, просмотрите статью [CONTRIBUTING.MD](/CONTRIBUTING.md).

Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [часто задаваемых вопросов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).

## Вопросы и комментарии

Мы будем рады узнать ваше мнение о примере Connect. Вы можете отправлять нам вопросы и предложения в разделе [Проблемы](issues) этого репозитория.

Общие вопросы о разработке решений для Microsoft Graph следует задавать на сайте [Stack Overflow](http://stackoverflow.com/questions/tagged/MicrosoftGraph+API). Обязательно помечайте свои вопросы и комментарии тегами \[MicrosoftGraph] и \[API].

## Дальнейшие действия

В этом примере показаны только основные компоненты, необходимые приложениям для работы с Microsoft Graph. Интерфейсы API Office 365 значительно расширяют возможности ваших приложений. Например, пользователи могут управлять расписанием своего рабочего дня с помощью календаря, находить во всех файлах из OneDrive только нужные сведения, а также искать необходимых пользователей в своих списках контактов. Узнать больше можно из [примеров фрагментов кода для Android](../../../android-java-snippets-sample). 
  
## Дополнительные ресурсы

* [Начало работы с интерфейсами API Office 365 на платформе Microsoft Graph](http://dev.office.com/getting-started/office365apis)
* [Общие сведения о Microsoft Graph](http://graph.microsoft.io)
* [Пакет SDK Microsoft Graph для Android](../../../msgraph-sdk-android)
* [Примеры фрагментов кода для Android](../../../android-java-snippets-sample)

## Авторские права
(c) Корпорация Майкрософт (Microsoft Corporation), 2019. Все права защищены.
